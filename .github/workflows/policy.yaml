name: demo-app-deployment

on:
  push:
    branches:
      - actions

jobs:
  evaluate-policy:
    runs-on:
      - self-hosted
      - rode-runners-prod
    steps:
      - name: Evaluate Policy
        id: policy
        uses: rode/evaluate-policy-action@action
        with:
          policyName: Sample Harbor Policy
          resourceUri: git://github.com/rode/demo-app/commit/7dcb88e64975e159ede3993842f8ce58fb0c1144@7dcb88e64975e159ede3993842f8ce58fb0c1144
          rodeHost: rode.rode-demo.svc.cluster.local:50051
          rodeInsecure: true

      - name: Test passing
        if: ${{ steps.policy.outputs.pass }}
        run: |
          echo "Made it!"
