name: pr

on:
  pull_request:
    branches:
      - dev
      - staging
      - prod

env:
  IMAGE: harbor.test/rode-demo/rode-demo-node-app@sha256:80a8511ea645aacf92825767039f8395be213ac7d22e0685c692619ce966f3cd
  RODE_HOST: 2.tcp.ngrok.io:16432
  OAUTH2_TOKEN_URL: 'https://aha-keycloak.ngrok.io/auth/realms/rode-demo/protocol/openid-connect/token'
  OAUTH2_CLIENT_ID: rode-enforcer

jobs:
  evaluate:
    runs-on:
      - self-hosted
      - rode-runners-prod
    steps:
      - name: test
        run: |
          echo ${{ env.GITHUB_EVENT_NAME }}
          echo ${{ env.GITHUB_EVENT_PATH }}
          cat ${{ env.GITHUB_EVENT_PATH }}
#      - name: Checkout Code
#        uses: actions/checkout@v2
#
#      - name: Fetch Access Token
#        uses: liatrio/github-actions/oauth2-token@master
#        id: token
#        with:
#          clientId: ${{ env.OAUTH2_CLIENT_ID }}
#          clientSecret: ${{ secrets.CLIENT_SECRET }}
#          tokenUrl: ${{ env.OAUTH2_TOKEN_URL }}
#
#      - name: Evaluate Resource
#        uses: rode/evaluate-policy-action@pr-comment
#        with:
#          accessToken: ${{ steps.token.outputs.accessToken }}
#          githubToken: ${{ secrets.GITHUB_TOKEN }}
#          enforce: true
#          policyGroup: rode-demo
#          resourceUri: ${{ env.IMAGE }}
#          rodeHost: ${{ env.RODE_HOST }}
#          rodeInsecure: true
